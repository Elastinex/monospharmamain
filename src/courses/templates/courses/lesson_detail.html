{% extends 'news/index_2.html' %}
{% load crispy_forms_tags %}
{% load static humanize  %}
{% load i18n %}


{% block content %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
	.box {
		height: 500px;
		width: 500px;
	}

	.foot {
		display: flex;
	}

	.foot .msg {
		flex-grow: 1;
	}
</style>
<div id="video" class='container'>
	<div class="alert alert-info" role="alert">
		Бүрэн дэлгэцээр үзэхийн тулд видеог 2 удаа дарна уу!
	</div>
	<div class='row'>
		<div class='col-sm-7 col-md-7 col-lg-7'>


			{% if lesson is not None %}
			<iframe width="460" height="315" src="https://www.youtube.com/embed/{{ lesson.youtube_code }}"
				allowfullscreen></iframe>
			{% comment %} <div class="button-container">
				<a href="#" style="color: #3f8f56; border-color: #3f8f56;"
					class="button button-border button-rounded button-fill course-button"><span>Өмнөх</span></a>
				<a href="#" style="color: #3f8f56; border-color: #3f8f56; margin-right:10px;"
					class="button button-border button-rounded button-fill course-button"><span>Дараах</span></a>
			</div> {% endcomment %}
			<div class="fancy-title title-bottom-border">
				<h4>{{ lesson.title }}</h4>
			</div>

			<div class="blog-post-title">
				<p style="overflow-wrap:break-word;"> {{ lesson.content|safe  }}</p>
				<h4><i class="icon-files">Хичээлд хавсаргасан файлууд</i> </h4>
				<ul>
					<li><a
							href="{% if lesson.pdf_file %}{{ lesson.pdf_file.url }}">{{ lesson.pdf_file_name }}{% endif %}</a>
					</li>
				</ul>
			</div>
			<div class="fancy-title title-bottom-border">
				<h4>Суртчилгаа</h4>
			</div>
			<iframe width="460" height="315" src="https://www.youtube.com/embed/{{ lesson.embedurl }}"
				allowfullscreen></iframe>
			<div class="text-center" style="margin-top: 25px; margin-bottom: 25px;">
				<a href="javascript:history.back()" class="button button-border button-circle button-dark">Буцах</a>
			</div>
			{% endif %}
		</div>
		<div class='col-sm-5 col-md-5'>
			<div class="tabs tabs-bordered clearfix" id="tab-2">
				<ul class="tab-nav clearfix">
					<li><a href="#tabs-5">Хичээлүүд</a></li>
					{% comment %} <li><a href="#tabs-6">Тайлбар</a></li> {% endcomment %}
					<li><a href="#tabs-7">Чат</a></li>
					<li class="hidden-phone"><a href="#tabs-8">Шалгалт</a></li>
				</ul>
				<div class="tab-container">
					<div class="tab-content clearfix" id="tabs-5">
						<div class="cl-item" id="lessons">
							<div class="cl-item" id="lessons">
								<h4 style="padding-top: 15px;">Энэ ангид орох хичээлүүд</h4>
								{% if course.lessons != None  %}
								{% for lesson in course.lessons %}
								<div data-aos="fade-right">
									<h5 class="pb-3" style="border-bottom: 1px solid gray; padding-bottom: 10px;">Хичээл
										№- {{lesson.position}} <a id="vazhdo"
											href="{{ lesson.get_absolute_url }}#video"><span
												class="pl-4">{{lesson.title}}</span></a></h5>
								</div>
								{% endfor %}
								{% endif %}
								{% if course.lessons|length == 0 %}
								<div class="alert alert-danger">Хичээл байхгүй байна.!!</div>
								{% endif %}
							</div>
						</div>
					</div>
					{% comment %} <div class="tab-content clearfix" id="tabs-6">
						Morbi tincidunt, dui sit amet facilisis feugiat, odio metus gravida ante, ut pharetra massa
						metus id nunc. Duis scelerisque molestie turpis. Sed fringilla, massa eget luctus malesuada,
						metus eros molestie lectus, ut tempus eros massa ut dolor. Aenean aliquet fringilla sem.
						Suspendisse sed ligula in ligula suscipit aliquam. Praesent in eros vestibulum mi adipiscing
						adipiscing. Morbi facilisis. Curabitur ornare consequat nunc. Aenean vel metus. Ut posuere
						viverra nulla. Aliquam erat volutpat. Pellentesque convallis. Maecenas feugiat, tellus
						pellentesque pretium posuere, felis lorem euismod felis, eu ornare leo nisi vel felis. Mauris
						consectetur tortor et purus.
					</div> {% endcomment %}
					<div class="tab-content clearfix" id="tabs-7">
						<section class="content">
							<div class="container-fluid">
								<div class="row">
									<div class="col-md-12">


										<div class="box">
											<div id="chat-messages" style="max-height: 450px; overflow-y: scroll;">
												{% for m in messages %}<b>{{ m.username }}</b>:
												{{ m.content }}<br><small>{{ m.date_added|date:'H:i' }}</small><br><br>{% endfor %}
											</div>

										</div>

										<div class="row">
											<div class="col-12">
												<div class="foot">
													<input type="text" class="msg" id="chat-message-input"
														placeholder="Мессеж бичих..." />
													<button type="submit" id="chat-message-submit"><i
															class="icon-paper-plane1"></i></button>
												</div>



											</div>


										</div>



										<small class="has-text-grey-light">Таны нэр: {{ name.username }}</small>

										<input type="hidden" id="myVar" name="variable" value="{{ lesson.title }}">
										<input type="hidden" id="myVar2" name="variable" value="{{ name.username }}">
									</div>
								</div>
							</div><!-- /.container-fluid -->

							<script type='text/javascript'>
								function scrollToBottom() {
									let objDiv = document.getElementById("chat-messages");
									objDiv.scrollTop = objDiv.scrollHeight;
								}

								scrollToBottom();

								const roomName = document.getElementById("myVar").value;
								const userName = document.getElementById("myVar2").value;
								console.log(userName)
								console.log(roomName)

								const chatSocket = new WebSocket(
									'ws://' +
									window.location.host +
									'/ws/' +
									roomName.charCodeAt() +
									'/'
								);
								console.log(chatSocket)
								chatSocket.onmessage = function (e) {
									console.log('onmessage');

									const data = JSON.parse(e.data);

									if (data.message) {
										document.querySelector('#chat-messages').innerHTML += ('<b>' + data.username + '</b>: ' + data
											.message + '<br>');
									} else {
										alert('The message is empty!');
									}

									scrollToBottom();
								};

								chatSocket.onclose = function (e) {
									console.log('The socket close unexpectadly');
								};

								document.querySelector('#chat-message-submit').onclick = function (e) {
									const messageInputDom = document.querySelector('#chat-message-input');
									const message = messageInputDom.value;

									chatSocket.send(JSON.stringify({
										'message': message,
										'username': userName,
										'room': roomName
									}));

									messageInputDom.value = '';
								};
							</script>
						</section>
					</div>
					<div class="tab-content clearfix" id="tabs-8">
						{% if course.state.subject == "over" %}
						Хичээл дууссан байна
						{% else %}
						<ol class="activity-feed">
							<p><em>Та зөвхөн 1 удаа санал өгөх боломжтой.</em></p>
							<ol class="activity-feed">
								<a href="{% url 'quiz_start_page' slug=lesson.slug %}"
									class="button button-border button-circle button-dark">{% trans "Шалгалт өгөх" %}</a>
							</ol>
						</ol>
						{% endif %}
						<input type="hidden" name="prefix" value="realestate-enquiry-">
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
</div>
{% endblock content %}
<style>
	.blog-post-title p {
		padding: 5px 0;
		border-top: 1px solid #b4bfc3;
	}

	.blog-post-title i {
		padding-right: 50px;
	}

	.hidden-desktop {
		display: none !important;
	}

	.course-button {
		color: #3f8f56;
		border-color: #3f8f56;

	}
</style>
<script>
	var myInterval = setInterval(change_live, 40000);

	function change_live() {
		var today = new Date();
		if (today.getHours() == 14 && today.getMinutes() == 30) {
			window.location.reload(1);
			clearInterval(myInterval);
		}
	};

	$(function () {
		PDFObject.embed("{% static 'conf/pdf/tailan.pdf' %}", "#report_pdf");

		$('#f_question').on('keypress', function (e) {
			if (e.which == 13)
				send_review();
		});
	});
</script>
<script src="{% static 'base/js/core/jquery.3.2.1.min.js' %}"></script>

<script src="{% static 'conf/js/core/jquery.3.2.1.min.js' %}"></script>
<script src="{% static 'conf/js/core/popper.min.js' %}"></script>
<script src="{% static 'conf/js/core/bootstrap.min.js' %}"></script>
<!-- jQuery UI -->
<script src="{% static 'conf/js/plugin/jquery-ui-1.12.1.custom/jquery-ui.min.js' %}"></script>
<script src="{% static 'conf/js/plugin/jquery-ui-touch-punch/jquery.ui.touch-punch.min.js' %}"></script>
<script src="{% static 'conf/js/plugin/sweetalert/sweetalert.min.js' %}"></script>

<script src="{% static 'conf/js/plugin/bootstrap-notify/bootstrap-notify.min.js' %}"></script>

<!-- jQuery Scrollbar -->
<script src="{% static 'conf/js/plugin/jquery-scrollbar/jquery.scrollbar.min.js' %}"></script>
<!-- Atlantis JS -->
<script src="{% static 'conf/js/atlantis.min.js' %}"></script>
<script src="{% static 'conf/js/pdfobject.min.js' %}"></script>